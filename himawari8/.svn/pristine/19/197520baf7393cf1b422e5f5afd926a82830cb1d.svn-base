#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""Himawari8 data mover and archiver
@author: Milos Korenciak"""

from __future__ import print_function

import datetime as DT

import os
from himawari8.mover import *


def filepath2datetime(file_name):
    """Method transforming the filename into datetime of the Himawari8 raw .nc file"""
    # IDE00221.201510090850.nc
    file_name = os.path.basename(file_name)
    datetime_ = DT.datetime.strptime(file_name[9:21], "%Y%m%d%H%M")
    datetime_ = datetime_.replace(tzinfo=None)  # make the datetime timezone aware
    return (datetime_ - DT.datetime(1970, 1, 1)).total_seconds()


DIR_MOVE_FROM = ["/data/HIMAWARI8_OPERATIONAL/BACKUP/", ]
MOVE_DICT = {}
for dir_ in DIR_MOVE_FROM:
    for dirpath, _, _ in os.walk(dir_):
        MOVE_DICT[dirpath] = "/mnt/bay_hdd/HIMAWARI8/"


CONSTANTS.update({
    # Mail the error stacktrace to this people if the downloader crashes
    "ADMINS_OF_MOVER": ['milos.korenciak@geomodel.eu', ],
# 'ioan.ferencik@geomodel.eu', 'tomas.cebecauer@geomodel.eu'],
    # Credentials to connect to given FTP
    "LATENCY": 2 * 86400,  # IN SECONDS! move the files older then 64 days
    "MOVE_DICT": MOVE_DICT,
    "DIR_STRUCTURE_TIMESLICING": True,
    "PATTERNS": ["IDE002??.[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9].nc"],
    # the method getting absolute file path; required to return datetime.datetime file belongs to
    "GET_FILE_TIME": filepath2datetime,
})

if __name__ == "__main__":
    main(os.path.abspath(__file__))
